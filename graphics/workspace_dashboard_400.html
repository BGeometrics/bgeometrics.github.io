<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>BGeometrics Workspace Charts</title>
  <meta content="Bitcoin Price" name="description">
  <meta content="__keywords__" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" media="print" onload="this.onload=null;this.removeAttribute('media');" fetchpriority="high">

  <!-- Vendor CSS Files -->
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../assets/css/style.css" rel="stylesheet">
  <link href="../assets/css/bgeometrics.css" rel="stylesheet">

  <!-- Google tag (gtag.js) --> 
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZR3ZFTF2FK"></script> 
  <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-ZR3ZFTF2FK'); </script>
</head>

<body>

    <link rel="stylesheet" type="text/css" href="https://code.highcharts.com/css/stocktools/gui.css">
    <link rel="stylesheet" type="text/css" href="https://code.highcharts.com/css/annotations/popup.css">

    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/stock/indicators/indicators-all.js"></script>
    <script src="https://code.highcharts.com/stock/modules/drag-panes.js"></script>
    <script src="https://code.highcharts.com/modules/annotations-advanced.js"></script>
    <script src="https://code.highcharts.com/modules/price-indicator.js"></script>
    <script src="https://code.highcharts.com/modules/full-screen.js"></script>
    <script src="https://code.highcharts.com/modules/stock-tools.js"></script>
    <script src="https://code.highcharts.com/stock/modules/heikinashi.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script src="https://charts.bgeometrics.com/assets/js/bgeometrics.js"></script>


  

    <section class="section dashboard">
      <div id="searchResults"></div>

      <!-- No axis -> price BTC
	      axis -> others
	      2axis -> chart bottom
	      3axis -> -100 to 100
	      4axis -> 100 to 10000
      -->
      <div class="row">
        <div class="col-lg-3">
          <select class="form-select" id="metrics" style="width:300px;">
            <option selected>Bitcoin Metrics On-Chain</option>
            <option value="10dma">10 day SMA</option>
            <option value="20dma">20 day SMA</option>
            <option value="40dma">40 day SMA</option>
            <option value="50dma">50 day SMA</option>
            <option value="155dma">155 day SMA</option>
            <option value="200dma">200 day SMA</option>
            <option value="addresses_active_4axis">Active Addresses</option>
            <option value="aviv_3axis">AVIV</option>
            <option value="hw_age_6m_10_3axis">BTC HODL (>6m) %</option>
            <option value="hw_age_6m_lth_supply_axis">BTC LTH (>6m) Supply</option>
            <option value="hw_age_6m_sth_supply_axis">BTC STH (<6m) Supply</option>
            <option value="bull_bear">Bull and Bear Cycles</option>
            <option value="market_cap_axis">Capitalization Market</option>
            <option value="realized_cap_axis">Capitalization Realized</option>
            <option value="investor_cap_axis">Capitalization Investor</option>
            <option value="thermo_cap_axis">Capitalization Thermo</option>
            <option value="stablecoin_usdt_axis">Capitalization USDT</option>
            <option value="stablecoin_usdc_axis">Capitalization USDC</option>
            <option value="choppiness_3axis">Choppiness 14 day</option>
            <option value="choppiness_5w_3axis">Choppiness 5 weeks</option>
            <option value="choppiness_10w_3axis">Choppiness 10 weeks</option>
            <option value="choppiness_10M_3axis">Choppiness 10 months</option>
            <option value="choppiness_7_3axis">Choppiness Weekly (SMA)</option>
            <option value="choppiness_30_3axis">Choppiness Monthly (SMA)</option>
            <option value="address_10k_1k_axis">Coins Addr. BTC &gt;1000 &lt;10000</option>
            <option value="delta_cap">Delta cap</option>
            <option value="total_btc_etf_btc_axis">ETF Total BTC</option>
            <option value="flow_btc_etf_axis">ETF Flow</option>
            <option value="fear_greed_3axis">Fear and Greed</option>
            <option value="fedfunds_axis">Fed Funds</option>
            <option value="gold_yf_axis">Gold</option>
            <option value="google_trends_3axis">Google Trends</option>
            <option value="halving">Halvings</option>
            <option value="hashprice_3axis">Hashprice</option>
            <option value="hashrate_axis">Hashrate</option>
            <option value="glm2_data_axis">M2 Global</option>
            <option value="max_pain">Max Pain</option>
            <option value="min_pain">Min Pain</option>
            <option value="mstr_yf_axis">MicroStrategy</option>
            <option value="mvocdd">MVOCDD</option>
            <option value="mvrv_zscore_3axis">MVRV Z-Score</option>
            <option value="mvrv_3axis">MVRV</option>
            <option value="sth_mvrv_3axis">MVRV STH</option>
            <option value="lth_mvrv_3axis">MVRV LTH</option>
            <option value="realized_profit_loss_ratio_3axis">Realized Profit Loss Ratio</option>
            <option value="nrpl_4axis">NRPL</option>
            <option value="nrpl_usd_4axis">NRPL USD</option>
            <option value="nupl_3axis">NUPL</option>
            <option value="lth_nupl_3axis">NUPL LTH</option>
            <option value="sth_nupl_3axis">NUPL STH</option>
            <option value="nvts_bg_4axis">Dynamic Range NVTS</option>
            <option value="oi_total_axis">Open Interest Futures</option>
            <option value="power_law">Powered Law</option>
            <option value="power_law_floor">Powered Law Floor</option>
            <option value="puell_multiple_3axis">Puell Multiple</option>
            <option value="profit_loss_3axis">Ratio Profit Loss</option>
            <option value="realized_price">Realized Price</option>
            <option value="sth_realized_price">Realized Price STH</option>
            <option value="lth_realized_price">Realized Price LTH</option>
            <option value="sth_realized_price_1m">Realized Price STH 1m</option>
            <option value="sth_realized_price_3m">Realized Price STH 3m</option>
            <option value="realized_profit_lth_4axis">Realized Profit LTH</option>
            <option value="realized_loss_lth_4axis">Realized Loss LTH</option>
            <option value="realized_profit_sth_4axis">Realized Profit STH</option>
            <option value="realized_loss_sth_4axis">Realized Loss STH</option>
            <option value="relevant">Relevant dates</option>
            <option value="rhodl_1m_3axis">RHodl 1m</option>
            <option value="sopr_3axis">SOPR</option>
            <option value="sth_sopr_3axis">SOPR STH</option>
            <option value="lth_sopr_3axis">SOPR LTH</option>
            <option value="sopr_sth_30sma_3axis">SOPR STH 30D MA</option>
            <option value="sopr_sth_365sma_3axis">SOPR STH 365D MA</option>
            <option value="sp500_yf_axis">SP&500</option>
            <option value="profit_loss_3axis">Supply Profit and Loss</option>
            <option value="lth_supply_4axis">Supply LTH</option>
            <option value="sth_supply_4axis">Supply STH</option>
            <option value="loss_lth_3axis">Supply LTH Loss</option>
            <option value="loss_sth_3axis">Supply STH Loss</option>
            <option value="profit_lth_3axis">Supply LTH Profit</option>
            <option value="profit_sth_3axis">Supply STH Profit</option>
            <option value="tsla_yf_axis">Tesla</option>
            <option value="vdd_multiple_3axis">VDD Multiple</option>
            <option value="vocdd">VOCDD</option>
            <option value="volatility_3axis">Volatility Annualized 30D</option>
            <option value="zone_0">Zone 0</option>
            <option value="zone_1">Zone 1</option>
          </select>
        </div>

        <div class="col-lg-1">
          <button class="btn" onclick="deleteSeries()">Remove</button>
        </div>

        <div class="col-lg-3">
          <select class="form-select" id="overlays" style="width:300px;">
            <option value="pc" selected="selected">BTC Price</option>
            <option value="bb">Bollinger Bands</option>
            <option value="dema">DEMA (Double Exponential Moving Aver)</option>
            <option value="ema">EMA (Exponential Moving Average)</option>
            <option value="linearRegression">Linear Regression</option>
            <option value="sma">SMA (Simple Moving Average)</option>
            <option value="tema">TEMA (Triple Exponential Moving Aver)</option>
            <option value="wma">VWAP (Volume Weighted Average Price)</option>
          </select>
        </div>

        <div class="col-lg-3">
          <select class="form-select" id="oscillators" style="width:300px;">
            <option value="osc" selected="selected">Oscillator</option>
            <option value="apo">Absolute price indicator</option>
            <option value="aroon">Aroon</option>
            <option value="aroonoscillator">Aroon oscillator</option>
            <option value="disparityindex">Disparity Index</option>
            <option value="cmo">CMO (Chande Momentum Oscillator)</option>
            <option value="dpo">Detrended price</option>
            <option value="linearRegressionAngle">Linear Regression Angle</option>
            <option value="linearRegressionIntercept">Linear Regression Intercept</option>
            <option value="linearRegressionSlope">Linear Regression Slope</option>
            <option value="macd">MACD (Moving Average Convergence)</option>
            <option value="ppo">Percentage Price oscillator</option>
            <option value="roc">RoC (Rate of Change)</option>
            <option value="rsi">RSI (Relative Strength Index)</option>
            <option value="trix">TRIX</option>
          </select>
        </div>

        <div class="col-lg-1">
          <select class="form-select" id="zoom" style="width:120px;">
	    <option selected>Zoom</option>
	    <option value="600">600px</option>
            <option value="700">700px</option>
            <option value="800">800px</option>
            <option value="900">900px</option>
            <option value="1000">1000px</option>
            <option value="1100">1100px</option>
            <option value="1200">1200px</option>
            <option value="1300">1300px</option>
            <option value="1400">1400px</option>
            <option value="1500">1500px</option>
            <option value="1600">1600px</option>
          </select>
        </div>


        <div class="row">
          <div class="col-lg-1">
            <button class="btn" onclick="">Formula:</button>
          </div>
          <div class="col-lg-1">
            <input type="text" class="form-control" id="number" value="0">
          </div>
          <div class="col-lg-1">
            <select class="form-select" id="operator1">
              <option selected value=""></option>
              <option value="+">+</option>
              <option value="-">-</option>
              <option value="*">*</option>
              <option value="/">/</option>
            </select>
          </div>
          <div class="col-lg-2">
            <select class="form-select" id="metric1">
              <option selected>Metric1</option>
              <option value="BTC Price">BTC Price</option>
            </select>
          </div>
          <div class="col-lg-1">
            <select class="form-select" id="operator2">
              <option selected value=""></option>
              <option value="+">+</option>
              <option value="-">-</option>
              <option value="*">*</option>
              <option value="/">/</option>
            </select>
          </div>
          <div class="col-lg-2">
            <select class="form-select" id="metric2">
              <option selected>Metric2</option>
              <option value="BTC Price">BTC Price</option>
            </select>
          </div>
          <div class="col-lg-1">
            <button class="btn" onclick="draw()">Draw</button>
          </div>
        </div>
      </div>

      <div id="container-iframe" style="width:100%; height:400px; margin: 0 auto;"></div>

      <script>
            var zoomChart = 600;
            var metricsId = "";
            const COOKIE_NAME = "bg";

            (async () => {
                const data_price = await fetch(
                    'https://charts.bgeometrics.com/files/realized_price_btc_price.json'
                ).then(response => response.json());

            chart = Highcharts.stockChart('container-iframe', {
                stockTools: {
                    gui: {
                        buttons: ['linLogSwitch', 'separator', 'indicators', 'separator', 'simpleShapes', 'lines', 'crookedLines', 'measure', 'advanced', 'separator', 'verticalLabels', 'flags', 'separator', 'zoomChange', 'fullScreen', 'separator', 'currentPriceIndicator', 'toggleAnnotations'],
                        definitions: {
                            linLogSwitch: {
                                className: 'highcharts-lin-log-switch',
                                symbol: 'logarithmic.svg'
                            }
                        }
                    }
                },
                navigation: {
                    bindings: {
                        linLogSwitch: {
                            className: 'highcharts-lin-log-switch',
                            init: function (button) {
                                const chart = this.chart,
                                    isLogarithmic = chart.yAxis[1].logarithmic,
                                    axisTypeIcon = isLogarithmic ? 'logarithmic.svg' : 'linear.svg',
                                    iconURL = 'https://code.highcharts.com/9.2.2/gfx/stock-icons/' + axisTypeIcon;

                                chart.yAxis[0].update({
                                    type: isLogarithmic ? 'linear' : 'logarithmic',
                                    minorTickInterval: isLogarithmic ? null : 'auto'
                                }, false)    
                                chart.yAxis[1].update({
                                    type: isLogarithmic ? 'linear' : 'logarithmic',
                                    minorTickInterval: isLogarithmic ? null : 'auto'
                                });

                                button.firstChild.style['background-image'] = `url(${iconURL})`;

                                Highcharts.fireEvent(
                                    this,
                                    'deselectButton',
                                    { button: button }
                                );
                            }
                        }
                    }
                },
                title: {
                    align: 'left',
                },

                chart: {
                    renderTo: 'container-iframe',
                    events: {
                        load: function() {
                            var image = new Image();
			                      var adresse_image = "https://charts.bgeometrics.com/assets/img/BGeometrics_logo.png";
                            image.src = adresse_image;

                            var height_image = 128;
                            var width_image = 128;
                            var textX = this.plotLeft + (this.plotWidth * 0.5);
                            var textY = this.plotTop + (this.plotHeight * 0.5);
                            var position_x = textX - width_image / 2;
                            var position_y = textY - height_image / 2;
                            this.renderer.image(adresse_image, position_x, position_y, width_image, height_image)
                                .css({position: 'relative', "margin-left": "-90px", opacity: 0.1})
                                .attr({zIndex: 1})
                                .add();
                        }
                    }
                },

		          plotOptions:{
                  series:{
                      showInLegend:true
                  }
              },

            	yAxis: [{
                    labels: {
                        align: 'left',
                    },
                    title: {
                        text: 'BTC price'
                    },
                    type: 'logarithmic',
                }, {
                    opposite: false
                }, {
                    top: '70%',
                    height: '30%'
                }, {
                    opposite: false
                }, {
                    opposite: false
                }, {
                }],

                series: [{
                    id:'BTC price',
                    name: 'BTC price',
                    color: 'black',
                    data: data_price,
                    tooltip: {
                        valueDecimals: 2
                    },
                    yAxis: 0
                }, {
                    type: 'pc',
                    id: 'overlay',
                    name: 'BTC Channel',
                    linkedTo: 'BTC price',
                    yAxis: 0
                }, {
                    id: 'oscillator',
                    name: 'Oscillator',
                    linkedTo: 'BTC price',
                    yAxis: 2
                }],

                legend:{
                    enabled:true,
                    floating: true,
                    verticalAlign: 'top',
                    y: 5,
                    align:'center'
                },

                navigator : {
                    enabled : false
                },
          
                rangeSelector: {
                  selected: 3,
                  buttons: [{
                      type: 'month',
                      count: 1,
                      text: '1m'
                  }, {
                      type: 'month',
                      count: 3,
                      text: '3m'
                  }, {
                      type: 'month',
                      count: 6,
                      text: '6m'
                  }, {
                      type: 'year',
                      count: 1,
                      text: '1y'
                  }, {
                      type: 'year',
                      count: 2,
                      text: '2y'
                  }, {
                      type: 'year',
                      count: 4,
                      text: '4y'
                  }, {
                      type: 'all',
                      text: 'All'
                  }]
                },

                credits: {
                    text: 'Powered by BGeometrics.com',
                    href: 'https://charts.bgeometrics.com',
                    style: {
                        font: '11px sans-serif, Verdana, "Trebuchet MS"'
                    },
                    position: {
                        align: 'right',
                        x: -70,
                        y: -124
                    }                
                },
                responsive: {
                    rules: [{
                        condition: {
                            maxWidth: 800
                        },
                        chartOptions: {
                            rangeSelector: {
                                inputEnabled: false
                            }
                        }
                    }]
                }
            });
        })();

        function init(){
        }

        document.getElementById('metrics').addEventListener("change", function () {
          var e = document.getElementById("metrics");
          var value = e.value;
          var text = e.options[e.selectedIndex].text;
          var selectElement = document.getElementById('metric1');
          var newOption = document.createElement('option');
          newOption.value = value;
          newOption.text = text;
          selectElement.appendChild(newOption);
          var selectElement2 = document.getElementById('metric2');
          var newOption2 = document.createElement('option');
          newOption2.value = value;
          newOption2.text = text;
          selectElement2.appendChild(newOption2);
          changeMetrics();
        });

        document.getElementById('zoom').addEventListener("change", zoom);

        function zoom() {
            var e = document.getElementById("zoom");
            var value = e.value;

            const iframeDiv = document.getElementById('container-iframe');
            iframeDiv.style.height = value + 'px'; 

            zoomChart = value;
        }

        document.getElementById('overlays').addEventListener("change", overlays_change);
            
        function overlays_change(e) {
            series = chart.get('overlay');

            if (series) {
                series.remove(false);
            }
            chart.addSeries({
                type: e.target.value,
                linkedTo: 'BTC price',
                id: 'overlay'
            });
        }

        document.getElementById('oscillators').addEventListener("change", oscillators_change); 
            
        function oscillators_change(e) {
            series = chart.get('oscillator');

            if (series) {
                series.remove(false);
            }
            chart.addSeries({
                type: e.target.value,
                linkedTo: 'BTC price',
                id: 'oscillator',
                yAxis: 2
            });
        }

        function deleteTheSeries() {
          const selectElement = document.getElementById('metric1');
          for (let i = selectElement.options.length - 1; i >= 0; i--) {
            if (selectElement.options[i].text != "Metric1" &&
              selectElement.options[i].text != "BTC Price") {
              selectElement.remove(i);
            }
          }
          const selectElement2 = document.getElementById('metric2');
          for (let i = selectElement2.options.length - 1; i >= 0; i--) {
            if (selectElement2.options[i].text != "Metric2" &&
              selectElement2.options[i].text != "BTC Price") {
              selectElement2.remove(i);
            }
          }
          deleteSeries();
        }

        function draw() {
          var numberValue = document.getElementById("number").value;
          var operator1Value = document.getElementById("operator1").value;
          var operator2Value = document.getElementById("operator2").value;

          var e = document.getElementById("metric1");
          var metric1Value = e.options[e.selectedIndex].text;
          e = document.getElementById("metric2");
          var metric2Value = e.options[e.selectedIndex].text;

          metric1Serie = chart.series[0];
          metric2Serie = chart.series[0];

          for (var i = 0; i < chart.series.length; i++) {
            var series = chart.series[i];
            if (chart.series[i].name == metric1Value){
              metric1Serie = chart.series[i];
            }
            if (chart.series[i].name == metric2Value){
              metric2Serie = chart.series[i];
            }
          }

          var data = [];
          if (metric1Value !== "Metric1")  { // Must select a Metric 1
            for(var i = 0; i < metric1Serie.xData.length; i++) {
              dataIn = [];
              if (operator1Value === null || operator1Value === "") { // Operator 1 -> null
                if ((operator2Value === null || operator2Value === "") 
                    || (metric2Value === "Metric2"))  { // Operator 1 -> null and Operator 2 or Metric 2 -> null 
                  expression = metric1Serie.yData[i];
                }
                else { // Operatoe 1 -> null and Metric 2 and Operator 2 -> not null 
                  formula = metric1Serie.yData[i] + operator2Value + metric2Serie.yData[i];
                  expression = eval(formula);
                }
              }
              else { // Operator 1 -> not null
                if ((operator2Value === null || operator2Value === "") 
                    || (metric2Value === "Metric2"))  { //Operator 1 -> not null and Operator 2 or Metric 2 -> null  
                  formula = numberValue + operator1Value + metric1Serie.yData[i];
                  expression = eval(formula);
                }
                else { // Operator 1 -> not null and Operator 2 and Metric 2 -> not null
                  formula = numberValue + operator1Value + metric1Serie.yData[i] + operator2Value + metric2Serie.yData[i];
                  expression = eval(formula);
                }
              }
              dataIn.push(metric1Serie.xData[i], expression);
              data.push(dataIn);
            }

            chart.addSeries({
              data: data,
              yAxis: 2
            });
          }
        }

      </script>




</body>

</html>
